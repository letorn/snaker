<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>流程设计</title>
<script type="text/javascript" src="${ctx}/common/jquery.min.js"></script>
<script type="text/javascript" src="${ctx}/common/jquery.custom.js"></script>
<link rel="stylesheet" type="text/css" href="${ctx}/common/easyui/themes/default/easyui.css">
<link rel="stylesheet" type="text/css" href="${ctx}/common/easyui/themes/icon.css">
<script type="text/javascript" src="${ctx}/common/easyui/jquery.easyui.min.js"></script>
<script type="text/javascript" src="${ctx}/common/easyui/locale/easyui-lang-zh_CN.js"></script>
<script type="text/javascript" src="${ctx}/common/raphael-min.js"></script>
<script type="text/javascript" src="${ctx}/common/snaker.designer.js"></script>
</head>
<body>
<div class="easyui-layout" data-options="fit:true">
	<div id="precess-designer-toolbox" data-options="region:'west',split:true,title:'工具'" style="width:110px;text-align:center">
		<br /><a id="process-designer-toolbox-save" class="easyui-linkbutton">保存</a><br />
		<br /><input id="precess-designer-toolbox-moveable" class="easyui-switchbutton" data-options="onText:'移动',offText:'连线'" style="width:80%;margin:10px;padding:10px;" checked><br />
		<br /><a id="process-designer-toolbox-ele-delete" class="easyui-linkbutton">删除</a><br /><br />
		<div class="easyui-accordion" data-options="border:false,multiple:true">
			<div data-options="title:'通用',collapsed:false" style="text-align:center;padding-left:10px;padding-top:10px">
				<p class="precess-designer-toolbox-citem" data-mtype="begin" style="width:80px;height:20px;line-height:20px;background:#fafafa">开始</p>
				<p class="precess-designer-toolbox-citem" data-mtype="end" style="width:80px;height:20px;line-height:20px;background:#fafafa">结束</p>
				<p class="precess-designer-toolbox-citem" data-mtype="addFields" style="width:80px;height:20px;line-height:20px;background:#fafafa">添加属性</p>
			</div>
			<div data-options="title:'输入',collapsed:false" style="text-align:center;padding-left:10px;padding-top:10px">
				<p class="precess-designer-toolbox-citem" data-mtype="tableinput" style="width:80px;height:20px;line-height:20px;background:#fafafa">表格输入</p>
				<p class="precess-designer-toolbox-citem" data-mtype="webinput" style="width:80px;height:20px;line-height:20px;background:#fafafa">页面输入</p>
				<p class="precess-designer-toolbox-citem" data-mtype="excelinput" style="width:80px;height:20px;line-height:20px;background:#fafafa">Excel输入</p>
				<p class="precess-designer-toolbox-citem" data-mtype="hbinput" style="width:80px;height:20px;line-height:20px;background:#fafafa">湖北输入</p>
			</div>
			<div data-options="title:'映射',collapsed:false" style="text-align:center;padding-left:10px;padding-top:10px">
				<p class="precess-designer-toolbox-citem" data-mtype="tablemapper" style="width:80px;height:20px;line-height:20px;background:#fafafa">表格映射</p>
				<p class="precess-designer-toolbox-citem" data-mtype="excelmapper" style="width:80px;height:20px;line-height:20px;background:#fafafa">Excel映射</p>
			</div>
			<div data-options="title:'输出',collapsed:false" style="text-align:center;padding-left:10px;padding-top:10px">
				<p class="precess-designer-toolbox-citem" data-mtype="dbtableoutput" style="width:80px;height:20px;line-height:20px;background:#fafafa">表输出</p>
			</div>
			<div data-options="title:'上传',collapsed:false" style="text-align:center;padding-left:10px;padding-top:10px">
				<p class="precess-designer-toolbox-citem" data-mtype="dbprocoutput" style="width:80px;height:20px;line-height:20px;background:#fafafa">存储过程输出</p>
			</div>
		</div>
	</div>
	<div id="process-designer-tabs" class="easyui-tabs" data-options="region:'center'">
		<div id="process-designer-tabs-canvas" data-options="title:'画板'" style="position:absolute"></div>
		<div id="process-designer-tabs-content" data-options="title:'内容'" style="overflow:hidden;padding:0px 4px 4px 0px">
			<textarea draggable="false" dropzone="false" spellcheck="false" style="width:100%;height:100%;border:0px;outline:none;resize:none"></textarea>
		</div>
	</div>
	<div data-options="region:'east',split:true,title:'属性'" style="width:300px">
		<form id="process-designer-prop-form" style="height:50px">
			<br />
			名称：<input type="text" class="easyui-textbox" style="width:250px" name="name"></input>
		</form>
		<table id="process-designer-prop-box" class="easyui-propertygrid" data-options="columns:[[{field:'name',title:'名称'},{field:'value',title:'内容',width:100}]],fix:true"></table>
	</div>
</div>


<div id="module-editor-data-headers" class="easyui-window" data-options="title:'头定义',modal:true,closed:true,footer:'#module-editor-data-headers-footer'" style="width:600px;height:500px">
	<table id="module-editor-data-headers-table" class="easyui-datagrid" data-options="border:false,fit:true,toolbar:'#module-editor-data-headers-toolbar'">
		<thead>
			<tr>
				<th data-options="field:'name',width:100,editor:{type:'textbox'}">名称</th>
				<th data-options="field:'type',width:100,formatter:function(v,r){var options=this.editor.options;for(var i=0;i<options.data.length;i++){if(options.data[i][options.valueField]==v)return options.data[i][options.textField]}return ''},editor:{type:'combobox',options:{textField:'name',valueField:'value',data:[{name:'字符串',value:'string'},{name:'整形',value:'integer'},{name:'长整形',value:'long'},{name:'小数',value:'double'},{name:'日期',value:'date'}]}}">类型</th>
				<th data-options="field:'format',width:100,editor:{type:'textbox'}">格式</th>
			</tr>
		</thead>
	</table>
	<div id="module-editor-data-headers-toolbar">
		<a id="module-editor-data-headers-add" class="easyui-linkbutton">新增</a>
		<a id="module-editor-data-headers-remove" class="easyui-linkbutton">删除</a>
	</div>
</div>
<div id="module-editor-data-headers-footer" style="padding:5px;">
	<a id="module-editor-data-headers-confirm" class="easyui-linkbutton" style="width:80px">确定</a>
	<a id="module-editor-data-headers-cancel" class="easyui-linkbutton" style="width:80px">取消</a>
</div>


<div id="module-editor-data-rows" class="easyui-window" data-options="title:'表数据',modal:true,closed:true,footer:'#module-editor-data-rows-footer'" style="width:600px;height:500px">
	<table id="module-editor-data-rows-table" class="easyui-datagrid" data-options="border:false,fit:true,toolbar:'#module-editor-data-rows-toolbar'"></table>
	<div id="module-editor-data-rows-toolbar">
		<a id="module-editor-data-rows-add" class="easyui-linkbutton">新增</a>
		<a id="module-editor-data-rows-remove" class="easyui-linkbutton">删除</a>
	</div>
</div>
<div id="module-editor-data-rows-footer" style="padding:5px;">
	<a id="module-editor-data-rows-confirm" class="easyui-linkbutton" style="width:80px">确定</a>
	<a id="module-editor-data-rows-cancel" class="easyui-linkbutton" style="width:80px">取消</a>
</div>


<div id="module-editor-data-mappers" class="easyui-window" data-options="title:'表映射',modal:true,closed:true,footer:'#module-editor-data-mappers-footer'" style="width:600px;height:500px">
	<table id="module-editor-data-mappers-table" class="easyui-datagrid" data-options="border:false,fit:true,toolbar:'#module-editor-data-mappers-toolbar'">
		<thead>
			<tr>
				<th data-options="field:'from',width:100,editor:{type:'textbox'}">从</th>
				<th data-options="field:'to',width:100,editor:{type:'textbox'}">到</th>
			</tr>
		</thead>
	</table>
	<div id="module-editor-data-mappers-toolbar">
		字段：<input id="module-editor-data-mappers-name" class="easyui-combobox" data-options="valueField:'name',textField:'name'">
		<a id="module-editor-data-mappers-add" class="easyui-linkbutton">新增</a>
	</div>
</div>
<div id="module-editor-data-mappers-footer" style="padding:5px;">
	<a id="module-editor-data-mappers-confirm" class="easyui-linkbutton" style="width:80px">确定</a>
	<a id="module-editor-data-mappers-cancel" class="easyui-linkbutton" style="width:80px">取消</a>
</div>

<div id="module-editor-start-urls" class="easyui-window" data-options="title:'开始链接',modal:true,closed:true,footer:'#module-editor-start-urls-footer'" style="width:700px;height:400px">
	<table id="module-editor-start-urls-table" class="easyui-datagrid" data-options="border:false,fit:true,toolbar:'#module-editor-start-urls-toolbar',rownumbers:true">
		<thead>
			<tr>
				<th data-options="field:'startUrl',width:600,editor:{type:'textbox'}">startUrl</th>
			</tr>
		</thead>
	</table>
	<div id="module-editor-start-urls-toolbar">
		<a id="module-editor-start-urls-add" class="easyui-linkbutton">新增</a>
		<a id="module-editor-start-urls-remove" class="easyui-linkbutton">删除</a>
	</div>
</div>
<div id="module-editor-start-urls-footer" style="padding:5px;">
	<a id="module-editor-start-urls-confirm" class="easyui-linkbutton" style="width:80px">确定</a>
	<a id="module-editor-start-urls-cancel" class="easyui-linkbutton" style="width:80px">取消</a>
</div>

<div id="module-editor-data-paths" class="easyui-window" data-options="title:'头定义',modal:true,closed:true,footer:'#module-editor-data-paths-footer'" style="width:1500px;height:700px">
	<table id="module-editor-data-paths-table" class="easyui-datagrid" data-options="border:false,fit:true,toolbar:'#module-editor-data-paths-toolbar'">
		<thead>
			<tr>
				<th data-options="field:'name',width:200,editor:{type:'textbox'}">名称</th>
				<th data-options="field:'xpath',width:550,editor:{type:'textbox'}">XPath</th>
				<th data-options="field:'regex',width:550,editor:{type:'textbox'},formatter:$.encodeHtml">Regex</th>
				<th data-options="field:'isAll',width:100,editor:{type:'textbox'}">isAll</th>
			</tr>
		</thead>
	</table>
	<div id="module-editor-data-paths-toolbar">
		<a id="module-editor-data-paths-add" class="easyui-linkbutton">新增</a>
		<a id="module-editor-data-paths-remove" class="easyui-linkbutton">删除</a>
	</div>
</div>
<div id="module-editor-data-paths-footer" style="padding:5px;">
	<a id="module-editor-data-paths-confirm" class="easyui-linkbutton" style="width:80px">确定</a>
	<a id="module-editor-data-paths-cancel" class="easyui-linkbutton" style="width:80px">取消</a>
</div>


<div id="module-editor-proc-fields" class="easyui-window" data-options="title:'字段映射',modal:true,closed:true,footer:'#module-editor-proc-fields-footer'" style="width:600px;height:500px">
	<table id="module-editor-proc-fields-table" class="easyui-datagrid" data-options="border:false,fit:true">
		<thead>
			<tr>
				<th data-options="field:'name',width:100">表字段</th>
				<th data-options="field:'from',width:100,editor:{type:'textbox'}">映射字段</th>
				<th data-options="field:'default',width:100,editor:{type:'textbox'}">默认值</th>
				<th data-options="field:'notnull',width:100,editor:{type:'combobox',options:{textField:'name',valueField:'value',data:[{name:'不能为空',value:'true'},{name:'可以为空',value:'false'}]}}">为空是否插入</th>
			</tr>
		</thead>
	</table>
</div>
<div id="module-editor-proc-fields-footer" style="padding:5px;">
	<a id="module-editor-proc-fields-confirm" class="easyui-linkbutton" style="width:80px">确定</a>
	<a id="module-editor-proc-fields-cancel" class="easyui-linkbutton" style="width:80px">取消</a>
</div>


<div id="module-editor-params" class="easyui-window" data-options="title:'参数定义',modal:true,closed:true,footer:'#module-editor-params-footer'" style="width:600px;height:500px">
	<table id="module-editor-params-table" class="easyui-datagrid" data-options="border:false,fit:true">
		<thead>
			<tr>
				<th data-options="field:'name'" style="width:20%">名称</th>
				<th data-options="field:'type',formatter:function(v){return {string:'字符串',integer:'数字',date:'日期',file:'文件'}[v]}" style="width:20%">类型</th>
				<th data-options="field:'editor',formatter:function(v,r){var options=this.editor.options;for(var i=0;i<options.data.length;i++){if(options.data[i][options.valueField]==v)return options.data[i][options.textField]}return ''},editor:{type:'combobox',options:{textField:'name',valueField:'value',data:[{name:'文本框',value:'textbox'},{name:'数字框',value:'numberspinner'},{name:'下拉框',value:'combobox'},{name:'日期框',value:'datebox'},{name:'文件框',value:'filebox'}]}}" style="width:20%">编辑器</th>
				<th data-options="field:'options',editor:'textbox'" style="width:40%">选项</th>
			</tr>
		</thead>
	</table>
</div>
<div id="module-editor-params-footer" style="padding:5px;">
	<a id="module-editor-params-confirm" class="easyui-linkbutton" style="width:80px">确定</a>
	<a id="module-editor-params-cancel" class="easyui-linkbutton" style="width:80px">取消</a>
</div>

<div id="module-editor-field-table" class="easyui-window" data-options="title:'添加属性',modal:true,closed:true,footer:'#module-editor-field-table-footer'" style="width:600px;height:500px">
	<table id="module-editor-field-table-table" class="easyui-datagrid" data-options="border:false,fit:true,toolbar:'#module-editor-field-table-toolbar'">
		<thead>
			<tr>
				<th data-options="field:'name',width:100,editor:{type:'textbox'}">属性名称</th>
				<th data-options="field:'type',width:100,formatter:function(v,r){var options=this.editor.options;for(var i=0;i<options.data.length;i++){if(options.data[i][options.valueField]==v)return options.data[i][options.textField]}return ''},editor:{type:'combobox',options:{textField:'name',valueField:'value',data:[{name:'常量',value:'constant'},{name:'变量',value:'variable'},{name:'脚本',value:'script'},{name:'当前时间',value:'currentdate'},{name:'坐标',value:'coordinate'},{name:'企业账号',value:'entaccount'},{name:'求职者账号',value:'useraccount'},{name:'生成html页面',value:'createhtmlpage'},{name:'其他',value:'others'}]}}">类型</th>
				<th data-options="field:'datatype',width:100,formatter:function(v,r){var options=this.editor.options;for(var i=0;i<options.data.length;i++){if(options.data[i][options.valueField]==v)return options.data[i][options.textField]}return ''},editor:{type:'combobox',options:{textField:'name',valueField:'value',data:[{name:'字符串',value:'string'},{name:'整形',value:'integer'},{name:'长整形',value:'long'},{name:'小数',value:'double'},{name:'日期',value:'date'}]}}">数据类型</th>
				<th data-options="field:'value',width:100,editor:{type:'textbox'}">值</th>
			</tr>
		</thead>
	</table>
	<div id="module-editor-field-table-toolbar">
		<a id="module-editor-field-table-add" class="easyui-linkbutton">新增</a>
		<a id="module-editor-field-table-remove" class="easyui-linkbutton">删除</a>
	</div>
</div>
<div id="module-editor-field-table-footer" style="padding:5px;">
	<a id="module-editor-field-table-confirm" class="easyui-linkbutton" style="width:80px">确定</a>
	<a id="module-editor-field-table-cancel" class="easyui-linkbutton" style="width:80px">取消</a>
</div>
<script type="text/javascript">
	$(function() {
		var editor = {};
		editor.dataHeaders = {
			$window: $('#module-editor-data-headers'),
			$table: $('#module-editor-data-headers-table'),
			$btnAdd: $('#module-editor-data-headers-add'),
			$btnRemove: $('#module-editor-data-headers-remove'),
			$btnConfirm: $('#module-editor-data-headers-confirm'),
			$btnCancel: $('#module-editor-data-headers-cancel'),
			endEditing: function() {
				var _this = editor.dataHeaders;
				if (_this.lastEditingIndex == null) return true;
				if (_this.$table.datagrid('validateRow', _this.lastEditingIndex)) {
					_this.$table.datagrid('endEdit', _this.lastEditingIndex);
					_this.lastEditingIndex = null;
					return true;
				}
				return false;
			},
			init: function(index, row) {
				var _this = editor.dataHeaders;
				if (!_this._initEvent) {
					_this.$table.datagrid({
						onClickCell: function(index, field) {
							if (index != _this.lastEditingIndex) {
								if (_this.endEditing()) {
									_this.$table.datagrid('selectRow', index).datagrid('beginEdit', index);
									var editor = _this.$table.datagrid('getEditor', {index: index, field: field});
					                if (editor){
					                    ($(editor.target).data('textbox') ? $(editor.target).textbox('textbox') : $(editor.target)).focus();
					                }
					                _this.lastEditingIndex = index;
								} else {
									_this.$table.datagrid('selectRow', _this.lastEditingIndex);
								}
							}
						}
					});
					_this.$btnAdd.click(function() {
						_this.$table.datagrid('appendRow',{name: '', type: 'string', format: ''});
					});
					_this.$btnConfirm.click(function() {
						if (_this.endEditing()) {
							row.value = _this.$table.datagrid('getRows');
							Designer.PropBox.updateValue(index, row, true);
							_this.$window.window('close', true);
						}
					});
					_this.$btnCancel.click(function() {
						_this.$window.window('close', true);
					});
					_this.$btnRemove.click(function() {
						_this.$table.datagrid('deleteRow', _this.lastEditingIndex);
					});
					_this._initEvent = true;
				}
			},
			setValue: function(value) {
				editor.dataHeaders.$table.datagrid('loadData', value);
			},
			show: function() {
				editor.dataHeaders.$window.window('open', true);
			}
		}
		
		editor.dataRows = {
			$window: $('#module-editor-data-rows'),
			$table: $('#module-editor-data-rows-table'),
			$btnAdd: $('#module-editor-data-rows-add'),
			$btnRemove: $('#module-editor-data-rows-remove'),
			$btnConfirm: $('#module-editor-data-rows-confirm'),
			$btnCancel: $('#module-editor-data-rows-cancel'),
			endEditing: function() {
				var _this = editor.dataRows;
				if (_this.lastEditingIndex == null) return true;
				if (_this.$table.datagrid('validateRow', _this.lastEditingIndex)) {
					_this.$table.datagrid('endEdit', _this.lastEditingIndex);
					_this.lastEditingIndex = null;
					return true;
				}
				return false;
			},
			_editor: {string: 'textbox', integer: 'numberspinner', long: 'numberspinner', double: 'numberspinner', date: 'datetimebox'},
			init: function(index, row) {
				var _this = editor.dataRows;
				var headers = Designer.PropBox.current.data('dataHeaders');
				_this.$table.datagrid({
					columns: [headers.map(function(row) {return {title: row.name, field: row.name, width: 100, editor: _this._editor[row.type]}})],
					onClickCell: function(index, field) {
						if (index != _this.lastEditingIndex) {
							if (_this.endEditing()) {
								_this.$table.datagrid('selectRow', index).datagrid('beginEdit', index);
								var editor = _this.$table.datagrid('getEditor', {index: index, field: field});
				                if (editor){
				                    ($(editor.target).data('textbox') ? $(editor.target).textbox('textbox') : $(editor.target)).focus();
				                }
				                _this.lastEditingIndex = index;
							} else {
								_this.$table.datagrid('selectRow', _this.lastEditingIndex);
							}
						}
					},
					onEndEdit: function(index, row, changes) {
						for (var i = 0; i < headers.length; i ++) {
							var header = headers[i];
							if (header.type == 'integer' || header.type == 'long') {
								row[header.name] = parseInt(row[header.name]);
							} if (header.type == 'double') {
								row[header.name] = parseFloat(row[header.name]);
							} else {
								row[header.name] = String(row[header.name]);
							}
						}
					}
				});
			
				if (!_this._initEvent) {
					_this.$btnAdd.click(function() {
						_this.$table.datagrid('appendRow',{});
					});
					_this.$btnConfirm.click(function() {
						if (_this.endEditing()) {
							row.value = _this.$table.datagrid('getRows');
							Designer.PropBox.updateValue(index, row, true);
							_this.$window.window('close', true);
						}
					});
					_this.$btnCancel.click(function() {
						_this.$window.window('close', true);
					});
					_this.$btnRemove.click(function() {
						_this.$table.datagrid('deleteRow', _this.lastEditingIndex);
					});
					_this._initEvent = true;
				}
			},
			setValue: function(value) {
				editor.dataRows.$table.datagrid('loadData', value);
			},
			show: function() {
				editor.dataRows.$window.window('open', true);
			}
		}
		
		editor.fieldTable = {
				$window: $('#module-editor-field-table'),
				$table: $('#module-editor-field-table-table'),
				$btnRemove:$('#module-editor-field-table-remove'),
				$btnAdds: $('#module-editor-field-table-add'),
				$btnConfirm: $('#module-editor-field-table-confirm'),
				$btnCancel: $('#module-editor-field-table-cancel'),
				endEditing: function() {
					var _this = editor.fieldTable;
					if (_this.lastEditingIndex == null) return true;
					if (_this.$table.datagrid('validateRow', _this.lastEditingIndex)) {
						_this.$table.datagrid('endEdit', _this.lastEditingIndex);
						_this.lastEditingIndex = null;
						return true;
					}
					return false;
				},
				 _editor: {string: {type: 'textbox'}, integer: {type: 'numberbox'}, long: {type: 'numberbox'}},
				init: function(index, row) {
					var _this = editor.fieldTable;
					if (!_this._initEvent) {
						_this.$table.datagrid({
							onClickCell: function(index, field) {
								if (index != _this.lastEditingIndex) {
									if (_this.endEditing()) {
										_this.$table.datagrid('selectRow', index).datagrid('beginEdit', index);
										var editor = _this.$table.datagrid('getEditor', {index: index, field: field});
						                if (editor){
						                    ($(editor.target).data('textbox') ? $(editor.target).textbox('textbox') : $(editor.target)).focus();
						                }
						                _this.lastEditingIndex = index;
									} else {
										_this.$table.datagrid('selectRow', _this.lastEditingIndex);
									}
								}
							}
						});
						_this.$btnAdds.click(function() {
							_this.$table.datagrid('appendRow',{name: '', type: '',datatype:''});
						});
						_this.$btnConfirm.click(function() {
							if (_this.endEditing()) {
								row.value = _this.$table.datagrid('getRows');
								Designer.PropBox.updateValue(index, row, true);
								_this.$window.window('close', true);
							}
						});
						_this.$btnCancel.click(function() {
							editor.fieldTable.$window.window('close', true);
						});
						_this.$btnRemove.click(function() {
							_this.$table.datagrid('deleteRow', _this.lastEditingIndex);
						});
						_this._initEvent = true;
					}
				},
				setValue: function(value) {
						editor.fieldTable.$table.datagrid('loadData', value);
				},
				show: function() {
					editor.fieldTable.$window.window('open', true);
				} 
			}
		
		
		editor.dataMappers = {
			$window: $('#module-editor-data-mappers'),
			$table: $('#module-editor-data-mappers-table'),
			$comboName: $('#module-editor-data-mappers-name'),
			$btnAdd: $('#module-editor-data-mappers-add'),
			$btnConfirm: $('#module-editor-data-mappers-confirm'),
			$btnCancel: $('#module-editor-data-mappers-cancel'),
			endEditing: function() {
				var _this = editor.dataMappers;
				if (_this.lastEditingIndex == null) return true;
				if (_this.$table.datagrid('validateRow', _this.lastEditingIndex)) {
					_this.$table.datagrid('endEdit', _this.lastEditingIndex);
					_this.lastEditingIndex = null;
					return true;
				}
				return false;
			},
			_editor: {string: {type: 'textbox'}, integer: {type: 'numberbox'}, long: {type: 'numberbox'}},
			init: function(index, row) {
				var _this = editor.dataMappers;
				var headers = Designer.PropBox.current.data('dataHeaders')
				if (!_this._initEvent) {
					_this.$table.datagrid({
						onClickCell: function(index, field) {
							if (index != _this.lastEditingIndex) {
								if (_this.endEditing()) {
									_this.$table.datagrid('selectRow', index).datagrid('beginEdit', index);
									var editor = _this.$table.datagrid('getEditor', {index: index, field: field});
					                if (editor){
					                    ($(editor.target).data('textbox') ? $(editor.target).textbox('textbox') : $(editor.target)).focus();
					                }
					                _this.lastEditingIndex = index;
								} else {
									_this.$table.datagrid('selectRow', _this.lastEditingIndex);
								}
							}
						}
					});
					_this.$comboName.combobox({
						onSelect: function(record) {
							if (_this.lastSelectedIndex != undefined && _this.endEditing()) {
								_this._value[_this.lastSelectedIndex] = _this.$table.datagrid('getRows');
							}
							_this.$table.datagrid('loadData', _this._value[record.index]);
							_this.lastSelectedIndex = record.index;
						}
					});
					_this.$btnAdd.click(function() {
						_this.$table.datagrid('appendRow',{from: '', to: ''});
					});
					_this.$btnConfirm.click(function() {
						if (_this.endEditing()) {
							row.value = _this._value;
							Designer.PropBox.updateValue(index, row, true);
							_this.$window.window('close', true);
						}
					});
					_this.$btnCancel.click(function() {
						_this.$window.window('close', true);
					});
					_this._initEvent = true;
				}
				_this.$comboName.combobox('loadData', headers.map(function(row, index) {return {name: row.name, index: index}}));
				_this._value = headers.map(function() {return []});
				if (headers.length > 0) {
					_this.$comboName.combobox('select', headers[0].name);
				}
			},
			setValue: function(value) {
				for (var i = 0; i <　value.length; i ++) {
					editor.dataMappers._value[i] = value[i];
				}
			},
			show: function() {
				editor.dataMappers.$window.window('open', true);
			}
		}
		
		editor.startUrls = {
				$window: $('#module-editor-start-urls'),
				$table: $('#module-editor-start-urls-table'),
				$btnAdd: $('#module-editor-start-urls-add'),
				$btnRemove: $('#module-editor-start-urls-remove'),
				$btnConfirm: $('#module-editor-start-urls-confirm'),
				$btnCancel: $('#module-editor-start-urls-cancel'),
				endEditing: function() {
					var _this = editor.startUrls;
					if (_this.lastEditingIndex == null) return true;
					if (_this.$table.datagrid('validateRow', _this.lastEditingIndex)) {
						_this.$table.datagrid('endEdit', _this.lastEditingIndex);
						_this.lastEditingIndex = null;
						return true;
					}
					return false;
				},
				init : function(index, row) {
					var _this = editor.startUrls;
					if(!_this.initEvent) {
						_this.$table.datagrid({
							onClickCell: function(index, field) {
								if (index != _this.lastEditingIndex) {
									if (_this.endEditing()) {
										_this.$table.datagrid('selectRow', index).datagrid('beginEdit', index);
										var editor = _this.$table.datagrid('getEditor', {index: index, field: field});
										if (editor) {
											($(editor.target).data('textbox') ? $(editor.target).textbox('textbox') : $(editor.target)).focus();
										}
										_this.lastEditingIndex = index;
									} else {
										_this.$table.datagrid('selectRow', _this.lastEditingIndex);
									}
								}
							}
						});
						_this.$btnAdd.click(function() {
							_this.$table.datagrid('appendRow', {startUrl: ''});
						});
						_this.$btnRemove.click(function() {
							_this.$table.datagrid('deleteRow', _this.lastEditingIndex);
						});
						_this.$btnConfirm.click(function() {
							if (_this.endEditing()) {
								row.value = _this.$table.datagrid('getRows');
								Designer.PropBox.updateValue(index, row, true);
								_this.$window.window('close', true);
							}
						});
						_this.$btnCancel.click(function() {
							_this.$window.window('close', true);
						});
						_this.initEvent = true;
					}
				},
				setValue: function(value) {
					editor.startUrls.$table.datagrid('loadData', value);
				},
				show: function() {
					editor.startUrls.$window.window('open', true);
				}
		}
		
		editor.dataPaths = {
			$window: $('#module-editor-data-paths'),
			$table: $('#module-editor-data-paths-table'),
			$btnAdd: $('#module-editor-data-paths-add'),
			$btnRemove: $('#module-editor-data-paths-remove'),
			$btnConfirm: $('#module-editor-data-paths-confirm'),
			$btnCancel: $('#module-editor-data-paths-cancel'),
			endEditing: function() {
				var _this = editor.dataPaths;
				if (_this.lastEditingIndex == null) return true;
				if (_this.$table.datagrid('validateRow', _this.lastEditingIndex)) {
					_this.$table.datagrid('endEdit', _this.lastEditingIndex);
					_this.lastEditingIndex = null;
					return true;
				}
				return false;
			},
			init: function(index, row) {
				var _this = editor.dataPaths;
				if (!_this._initEvent) {
					_this.$table.datagrid({
						onClickCell: function(index, field) {
							if (index != _this.lastEditingIndex) {
								if (_this.endEditing()) {
									_this.$table.datagrid('selectRow', index).datagrid('beginEdit', index);
									var editor = _this.$table.datagrid('getEditor', {index: index, field: field});
					                if (editor){
					                    ($(editor.target).data('textbox') ? $(editor.target).textbox('textbox') : $(editor.target)).focus();
					                }
					                _this.lastEditingIndex = index;
								} else {
									_this.$table.datagrid('selectRow', _this.lastEditingIndex);
								}
							}
						}
					});
					_this.$btnAdd.click(function() {
						_this.$table.datagrid('appendRow',{name: '', xpath: '', regex: '', isAll: ''});
					});
					_this.$btnConfirm.click(function() {
						if (_this.endEditing()) {
							row.value = _this.$table.datagrid('getRows');
							Designer.PropBox.updateValue(index, row, true);
							_this.$window.window('close', true);
						}
					});
					_this.$btnCancel.click(function() {
						_this.$window.window('close', true);
					});
					_this.$btnRemove.click(function() {
						_this.$table.datagrid('deleteRow', _this.lastEditingIndex);
					});
					_this._initEvent = true;
				}
			},
			setValue: function(value) {
				editor.dataPaths.$table.datagrid('loadData', value);
			},
			show: function() {
				editor.dataPaths.$window.window('open', true);
			}
		}
		
		editor.procFields = {
			$window: $('#module-editor-proc-fields'),
			$table: $('#module-editor-proc-fields-table'),
			$btnConfirm: $('#module-editor-proc-fields-confirm'),
			$btnCancel: $('#module-editor-proc-fields-cancel'),
			endEditing: function() {
				var _this = editor.procFields;
				if (_this.lastEditingIndex == null) return true;
				if (_this.$table.datagrid('validateRow', _this.lastEditingIndex)) {
					_this.$table.datagrid('endEdit', _this.lastEditingIndex);
					_this.lastEditingIndex = null;
					return true;
				}
				return false;
			},
			init: function(index, row) {
				var _this = editor.procFields;
				if (!_this._initEvent) {
					_this.$table.datagrid({
						onClickCell: function(index, field) {
							if (index != _this.lastEditingIndex) {
								if (_this.endEditing()) {
									_this.$table.datagrid('selectRow', index).datagrid('beginEdit', index);
									var editor = _this.$table.datagrid('getEditor', {index: index, field: field});
					                if (editor){
					                    ($(editor.target).data('textbox') ? $(editor.target).textbox('textbox') : $(editor.target)).focus();
					                }
					                _this.lastEditingIndex = index;
								} else {
									_this.$table.datagrid('selectRow', _this.lastEditingIndex);
								}
							}
						}
					});
					_this.$btnConfirm.click(function() {
						if (_this.endEditing()) {
							row.value = _this.$table.datagrid('getRows');
							Designer.PropBox.updateValue(index, row, true);
							_this.$window.window('close', true);
						}
					});
					_this.$btnCancel.click(function() {
						_this.$window.window('close', true);
					});
					_this._initEvent = true;
				}
			},
			setValue: function(value) {
				var procName = Designer.PropBox.current.data('procName');
				var fields = [], newValue = [];
				if (procName == 'test') {
					fields = [{
						name: 'title',
						from: ''
					},{
						name: 'content',
						from: ''
					}];
				}
				
				if (procName == 'save_or_update_user') {
					fields = [{name:'name',	from:'name',default:''},{
							name:'gender',from:'gender',default:''},{
							name:'nation',from:'nation',default:''},{
							name:'mobile',from:'mobile',default:''},{
							name:'email',from:'email',default:''},{
							name:'experienceCode',from:'experienceCode',default:''},{
							name:'educationCode',from:'educationCode',default:''},{
							name:'household',from:'household',default:''},{
							name:'categoryCode',from:'categoryCode',default:''},{
							name:'status',from:'status',default:''},{
							name:'marriage',from:'marriage',default:''},{
							name:'certType',from:'certType',default:''},{
							name:'certId',from:'certId',default:''},{
							name:'birth',from:'birth',default:''},{
							name:'selfComment',from:'selfComment',default:''},{
							name:'locationCode',from:'locationCode',default:''},{
							name:'dataSrc',from:'dataSrc',default:''},{
							name:'dataKey',from:'dataKey',default:''},{
							name:'updateDate',from:'updateDate',default:''},{
							name:'createDate',from:'createDate',default:''},{
							name:'account',from:'account',default:''},{
							name:'currEnt',from:'currEnt',default:''},{
							name:'currEntPhone',from:'currEntPhone',default:''},{
							name:'currPostCode',from:'currPostCode',default:''},{
							name:'currPost',from:'currPost',default:''},{
							name:'lbsLon',from:'lbsLon',default:''},{
							name:'lbsLat',from:'lbsLat',default:''},{
							name:'accountStatus',from:'accountStatus',default:''}];


				}
				if(procName == 'save_or_update_ent') {
					fields = 	   
						[{
							name: ' name ',from:'name',default:''},{
					   		name: ' categoryCode ',from:'categoryCode',default:''},{
					        name: ' natureCode ',from:'natureCode',default:''},{
					        name: ' scaleCode ',from:'scaleCode',default:''},{
					        name: ' tag ',from:'tag',default:''},{
					        name: ' establish ',from:'establish',default:''},{
					        name:  'troduction ',from:'troduction',default:''},{
					        name: ' address ',from:'address',default:''},{
					        name: ' website ',from:'website',default:''},{
					        name: ' areaCode ',from:'areaCode',default:''},{
					        name: ' lbsLon ',from:'lbsLon',default:''},{
					        name: ' lbsLat ',from:'lbsLat',default:''},{
					        name: ' orgains',from:'orgains',default:''},{
					        name: ' license ',from:'license',default:''},{
					        name: ' contacter ',from:'contacter',default:''},{
					        name: ' publicContact ',from:'publicContact',default:''},{
					        name: ' phone ',from:'phone',default:''},{
					        name: ' fax ',from:'fax',default:''},{
					        name: ' mobile ',from:'mobile',default:''},{
					        name: ' email ',from:'email',default:''},{
					        name: ' qq ',from:'qq',default:''},{
					        name: ' dataSrc ',from:'dataSrc',default:''},{
					        name: ' dataKey ',from:'dataKey',default:''},{
					        name: ' updateDate ',from:'updateDate',default:''},{
					        name: ' createDate ',from:'createDate',default:''},{
				        	name: ' account ',from:'account',default:''},{
				        		name: ' role ',from:'role',default:''},{
				        		name: ' legalize ',from:'legalize',default:''}]
				}
				if(procName == 'save_or_update_post') {
					fields =[
							{name:'NAME',from:'NAME'},
							{name:'categoryCode',from:'categoryCode',default:''},
							{name:'natureCode',from:'natureCode',default:''},
							{name:'headcount',from:'headcount',default:''},
							{name:'age',from:'age',default:''},
							{name:'gender',from:'gender',default:''},
							{name:'salary',from:'salary',default:''},
							{name:'tag',from:'tag',default:''},
							{name:'troduction',from:'troduction',default:''},
							{name:'areaCode',from:'areaCode',default:''},
							{name:'address',from:'address',default:''},
							{name:'lbsLon',from:'lbsLon',default:''},
							{name:'lbsLat',from:'lbsLat',default:''},
							{name:'dataSrc',from:'dataSrc',default:''},
							{name:'dataKey',from:'dataKey',default:''},
							{name:'dataEntKey',from:'dataEntKey',default:''},
							{name:'updateDate',from:'updateDate',default:''},
							{name:'createDate',from:'createDate',default:''},
							{name:'experienceCode',from:'experienceCode',default:''},
							{name:'educationCode',from:'educationCode',default:''}
							 ]
				 }
				if(procName == 'save_or_update_information') {
					fields =[
							{name:'informationCode',from:'informationCode',default:''},
							{name:'title',from:'title',default:''},
							{name:'source',from:'source',default:''},
							{name:'contentType',from:'contentType',default:''},
							{name:'html_content' ,from:'html_content' ,default:''},
							{name:'htmlName',from:'htmlName' ,default:''},
							{name:'accountId ',from:'accountId',default:''},
							{name:'create_time ',from:'create_time',default:''},
							{name:'is_draft',from:'is_draft',default:''},
							{name:'summary',from:'summary',default:''},
							{name:'file_code',from:'file_code',default:''},
							{name:'is_cover',from:'is_cover',default:''},
							{name:'last_ip',from:'last_ip',default:''},
							{name:'last_account_id ',from:'last_account_id',default:''},
							{name:'last_modify_time ',from:'last_modify_time',default:''},
							{name:'order_type',from:'order_type',default:''},
							{name:'orders',from:'orders',default:''},
							{name:'appFuncntionCodes',from:'appFuncntionCodes',default:''},
							{name:'datasrc',from:'datasrc',default:''},
							{name:'datakey',from:'datakey',default:''}

							 ]
				 }
				
				for (var i = 0; i < fields.length; i ++) {
					var exist = false;
					for (var j = 0; j < value.length; j ++) {
						if (fields[i].name == value[j].name) {
							exist = true;
							newValue.push(value[j]);
							break;
						}
					}
					if (!exist) {
						newValue.push(fields[i]);
					}
				}
				editor.procFields.$table.datagrid('loadData', newValue);
			},
			show: function() {
				editor.procFields.$window.window('open', true);
			}
		};

		editor.tableFields = {
			$window: $('#module-editor-proc-fields'),
			$table: $('#module-editor-proc-fields-table'),
			$btnConfirm: $('#module-editor-proc-fields-confirm'),
			$btnCancel: $('#module-editor-proc-fields-cancel'),
			endEditing: function() {
				var _this = editor.tableFields;
				if (_this.lastEditingIndex == null) return true;
				if (_this.$table.datagrid('validateRow', _this.lastEditingIndex)) {
					_this.$table.datagrid('endEdit', _this.lastEditingIndex);
					_this.lastEditingIndex = null;
					return true;
				}
				return false;
			},
			init: function(index, row) {
				var _this = editor.tableFields;
				if (!_this._initEvent) {
					_this.$table.datagrid({
						onClickCell: function(index, field) {
							if (index != _this.lastEditingIndex) {
								if (_this.endEditing()) {
									_this.$table.datagrid('selectRow', index).datagrid('beginEdit', index);
									var editor = _this.$table.datagrid('getEditor', {index: index, field: field});
					                if (editor){
					                    ($(editor.target).data('textbox') ? $(editor.target).textbox('textbox') : $(editor.target)).focus();
					                }
					                _this.lastEditingIndex = index;
								} else {
									_this.$table.datagrid('selectRow', _this.lastEditingIndex);
								}
							}
						}
					});
					_this.$btnConfirm.click(function() {
						if (_this.endEditing()) {
							row.value = _this.$table.datagrid('getRows');
							Designer.PropBox.updateValue(index, row, true);
							_this.$window.window('close', true);
						}
					});
					_this.$btnCancel.click(function() {
						_this.$window.window('close', true);
					});
					_this._initEvent = true;
				}
			},
			setValue: function(value) {
				var tableName = Designer.PropBox.current.data('tableName');
				var fields = [], newValue = [];
				if (tableName == '') {
					fields = [{
						name: 'title',
						from: ''
					},{
						name: 'content',
						from: ''
					}];
				}
				
				if (tableName == 'blog') {
					fields = [{name:'title',from:'title'},{
							name:'content',from:'content'},{
							name:'test',from:'test'}
							];
				}
				if (tableName == 'db_enterprise') {
					fields = [{name:'name',from:'name',notnull:'true'},
					          {name:'account',from:'account',notnull:'false'},
					          {name:'category',from:'category',notnull:'false'},
					          {name:'category_code',from:'category_code',notnull:'true'},
					          {name:'nature',from:'nature',notnull:'false'},
					          {name:'nature_code',from:'nature_code',notnull:'false'},
					          {name:'scale',from:'scale',notnull:'false'},
					          {name:'scale_code',from:'scale_code',notnull:'false'},
					          {name:'tag',from:'tag',notnull:'false'},
					          {name:'establish',from:'establish',notnull:'false'},
					          {name:'introduction',from:'introduction',notnull:'false'},
					          {name:'area',from:'area',notnull:'false'},
					          {name:'area_code',from:'area_code',notnull:'false'},
					          {name:'address',from:'address',notnull:'false'},
					          {name:'lbs_lon',from:'lbs_lon',notnull:'false'},
					          {name:'lbs_lat',from:'lbs_lat',notnull:'false'},
					          {name:'website',from:'website',notnull:'false'},
					          {name:'orgains',from:'orgains',notnull:'false'},
					          {name:'license',from:'license',notnull:'false'},
					          {name:'contacter',from:'contacter',notnull:'false'},
					          {name:'public_contact',from:'public_contact',notnull:'false'},
					          {name:'phone',from:'phone',notnull:'false'},
					          {name:'fax',from:'fax',notnull:'false'},
					          {name:'mobile',from:'mobile',notnull:'false'},
					          {name:'email',from:'email',notnull:'false'},
					          {name:'qq',from:'qq',notnull:'false'},
					          {name:'visit_count',from:'visit_count',notnull:'false'},
					          {name:'data_src',from:'data_src',notnull:'true'},
					          {name:'data_key',from:'data_key',notnull:'true'},
					          {name:'update_date',from:'update_date',notnull:'false'},
					          {name:'create_date',from:'create_date',notnull:'false'},
					          {name:'role',from:'role',notnull:'true'},
					          {name:'legalize',from:'legalize',notnull:'true'}
							];
				}
				if (tableName == 'db_entpost') {
					fields = [
								{name:'name',from:'name',notnull:'false'},{
								name:'category',from:'category',notnull:'false'},{
								name:'category_code',from:'category_code',notnull:'false'},{
								name:'nature',from:'nature',notnull:'false'},{
								name:'nature_code',from:'nature_code',notnull:'false'},{
								name:'headcount',from:'headcount',notnull:'false'},{
								name:'age',from:'age',notnull:'false'},{
								name:'gender',from:'gender',notnull:'false'},{
								name:'salary',from:'salary',notnull:'false'},{
								name:'experience',from:'experience',notnull:'false'},{
								name:'experience_code',from:'experience_code',notnull:'false'},{
								name:'education',from:'education',notnull:'false'},{
								name:'education_code',from:'education_code',notnull:'false'},{
								name:'tag',from:'tag',notnull:'false'},{
								name:'introduction',from:'introduction',notnull:'false'},{
								name:'area',from:'area',notnull:'false'},{
								name:'area_code',from:'area_code',notnull:'false'},{
								name:'address',from:'address',notnull:'false'},{
								name:'lbs_lon',from:'lbs_lon',notnull:'false'},{
								name:'lbs_lat',from:'lbs_lat',notnull:'false'},{
								name:'data_src',from:'data_src',notnull:'false'},{
								name:'data_key',from:'data_key',notnull:'false'},{
								name:'data_ent_key',from:'data_ent_key',notnull:'false'},{
								name:'update_date',from:'update_date',notnull:'false'},{
								name:'create_date',from:'create_date',notnull:'false'}];
				}
				if (tableName == 'db_jobhunter') {
					fields = [
								{name:'name',from: 'name',notnull:'false'},
								{name:'account',from: 'account',notnull:'false'},
								{name:'account_status',from: 'account_status',notnull:'false'},
								{name:'gender',from: 'gender',notnull:'false'},
								{name:'nation',from: 'nation',notnull:'false'},
								{name:'mobile',from: 'mobile',notnull:'false'},
								{name:'email',from: 'email',notnull:'false'},
								{name:'qq',from: 'qq',notnull:'false'},
								{name:'experience',from: 'experience',notnull:'false'},
								{name:'experience_code',from: 'experience_code',notnull:'false'},
								{name:'education',from: 'education',notnull:'false'},
								{name:'education_code',from: 'education_code',notnull:'false'},
								{name:'major',from: 'major',notnull:'false'},
								{name:'household',from: 'household',notnull:'false'},
								{name:'polity',from: 'polity',notnull:'false'},
								{name:'category',from: 'category',notnull:'false'},
								{name:'category_code',from: 'category_code',notnull:'false'},
								{name:'hunter_status',from: 'hunter_status',notnull:'false'},
								{name:'hunter_status_code',from: 'hunter_status_code',notnull:'false'},
								{name:'marriage',from: 'marriage',notnull:'false'},
								{name:'cert_type',from: 'cert_type',notnull:'false'},
								{name:'cert_id',from: 'cert_id',notnull:'false'},
								{name:'birth',from: 'birth',notnull:'false'},
								{name:'height',from: 'height',notnull:'false'},
								{name:'weight',from: 'weight',notnull:'false'},
								{name:'location',from: 'location',notnull:'false'},
								{name:'location_code',from: 'location_code',notnull:'false'},
								{name:'address',from: 'address',notnull:'false'},
								{name:'lbs_lon',from: 'lbs_lon',notnull:'false'},
								{name:'lbs_lat',from: 'lbs_lat',notnull:'false'},
								{name:'curr_ent',from: 'curr_ent',notnull:'false'},
								{name:'curr_ent_phone',from: 'curr_ent_phone',notnull:'false'},
								{name:'curr_post',from: 'curr_post',notnull:'false'},
								{name:'curr_post_code',from: 'curr_post_code',notnull:'false'},
								{name:'data_src',from: 'data_src',notnull:'false'},
								{name:'data_key',from: 'data_key',notnull:'false'},
								{name:'update_date',from: 'update_date',notnull:'false'},
								{name:'create_date',from: 'create_date',notnull:'false'},
								{name:'self_comment',from: 'self_comment',notnull:'false' }];
				}
				if (tableName == 'db_talk') {
					fields = [{name:'id',from: 'id',notnull:'false'},
					          {name:'title',from: 'title',notnull:'false'},
					          {name:'content',from: 'content',notnull:'false'},
					          {name:'source',from: 'source',notnull:'false'},
					          {name:'data_src',from: 'data_src',notnull:'false'},
					          {name:'data_key',from: 'data_key',notnull:'false'},
					          {name:'update_date',from: 'update_date',notnull:'false'},
					          {name:'create_date',from: 'create_date',notnull:'false'}
					         ];
				}
				for (var i = 0; i < fields.length; i ++) {
					var exist = false;
					for (var j = 0; j < value.length; j ++) {
						if (fields[i].name == value[j].name) {
							exist = true;
							newValue.push(value[j]);
							break;
						}
					}
					if (!exist) {
						newValue.push(fields[i]);
					}
				}
				editor.tableFields.$table.datagrid('loadData', newValue);
			},
			show: function() {
				editor.tableFields.$window.window('open', true);
			}
		}

		editor.procName = {
			fixed: true,
			type: 'combobox',
			options: {
				textField: 'text',
				valueField: 'value',
				data: [{
					text: 'save_or_update_post',
					value: 'save_or_update_post'
				},{
					text: 'save_or_update_ent',
					value: 'save_or_update_ent'
				},{
					text: 'save_or_update_user',
					value: 'save_or_update_user'
				},{
					text: 'save_or_update_information',
					value: 'save_or_update_information'
				}]
			}
		};
		
		editor.jdbcUrl = {
				fixed: true,
				type: 'combobox',
				options: {
					textField: 'text',
					valueField: 'value',
					data: [{
						text: '测试数据库zcdh_uni_test',
						value: 'jdbc:mysql://192.168.1.30:3306/zcdh_uni_test?useUnicode=true&characterEncoding=utf8&autoReconnect=true&autoReconnectForPools=true'
					}]
				}
			};
		
		editor.interfaceName = {
				fixed: true,
				type: 'combobox',
				options: {
					textField: 'text',
					valueField: 'value',
					data: [{
						text: '用人单位信息查询',
						value: 'hbjyweb_webservice_cb20_xml_task'
					},{
						text: '招聘岗位信息查询',
						value: 'hbjyweb_webservice_cb21_xml_task'
					},{
						text: '个人信息查询',
						value: 'hbjyweb_webservice_cc20_xml_task'
					}],
					onSelect: function(record){
						if(record.value=='hbjyweb_webservice_cb20_xml_task'){
							Designer.PropBox.updateValue(9, {
								editor: 'text',
								name: 'params',
								value: [ 
								{
									name: 'ACB200',
									type: 'string',
									editor: 'textbox',
									options: ''
								}]
							}, true);
						}else if(record.value=='hbjyweb_webservice_cb21_xml_task'){
							Designer.PropBox.updateValue(9, {
								editor: 'text',
								name: 'params',
								value: [ 
								 {
									name: 'ACB200',
									type: 'string',
									editor: 'textbox',
									options: ''
								}]
							}, true);
						}else if(record.value=='hbjyweb_webservice_cc20_xml_task'){
							Designer.PropBox.updateValue(9, {
								editor: 'text',
								name: 'params',
								value: [{
									name: 'AAC001',
									type: 'string',
									editor: 'textbox',
									options: ''
								}]
							}, true);
						}
					}
				}
			};

		editor.tableName = {
			fixed: true,
			type: 'combobox',
			options: {
				textField: 'text',
				valueField: 'value',
				data: [{
					text: 'db_entpost',
					value: 'db_entpost'
				},
				{
					text: 'db_enterprise',
					value: 'db_enterprise'
				},
				{
					text: 'db_jobhunter',
					value: 'db_jobhunter'
				},
				{
					text: 'db_talk',
					value: 'db_talk'
				}]
			}
		};

		editor.excelFile = {
			fixed: true,
			type: 'combobox',
			options: {
				textField: 'name',
				valueField: 'name',
				url: '${ctx}/data/file/list?ftype=excelmapper'
			}
		};

		editor.doRecord = {
				fixed: true,
				type: 'combobox',
				options: {
					textField: 'text',
					valueField: 'value',
					value: true,
					data: [{
						text: 'true',
						value: true
					}, {
						text: 'false',
						value: false
					}]
				}
			};
		
		editor.params = {
			$window: $('#module-editor-params'),
			$table: $('#module-editor-params-table'),
			$btnConfirm: $('#module-editor-params-confirm'),
			$btnCancel: $('#module-editor-params-cancel'),
			endEditing: function() {
				var _this = editor.params;
				if (_this.lastEditingIndex == null) return true;
				if (_this.$table.datagrid('validateRow', _this.lastEditingIndex)) {
					_this.$table.datagrid('endEdit', _this.lastEditingIndex);
					_this.lastEditingIndex = null;
					return true;
				}
				return false;
			},
			init: function(index, row) {
				var _this = editor.params;
				if (!_this._initEvent) {
					_this.$table.datagrid({
						onClickCell: function(index, field) {
							if (index != _this.lastEditingIndex) {
								if (_this.endEditing()) {
									_this.$table.datagrid('selectRow', index).datagrid('beginEdit', index);
									var editor = _this.$table.datagrid('getEditor', {index: index, field: field});
					                if (editor) {
					                	var $editor = $(editor.target), paramType = row.value[index].type;
					                	if (field == 'editor') {
					                		if (paramType == 'string') {
						                		$editor.combobox('loadData', [
						                			{name:'文本框', value:'textbox'},
						                			{name:'下拉框', value:'combobox'}
						                		]);
						                	} else if (paramType == 'integer') {
						                		$editor.combobox('loadData', [
						                			{name:'数字框', value:'numberspinner'},
						                			{name:'下拉框', value:'combobox'}
						                		]);
						                	} else if (paramType == 'file') {
						                		$editor.combobox('loadData', [
						                			{name:'文件框', value:'filebox'}
						                		]);
						                	} else if (paramType == 'date') {
						                		$editor.combobox('loadData', [
						                			{name:'日期框', value:'datebox'}
						                		]);
						                	} else {
						                		$editor.combobox('loadData', []);
						                	}
					                	}
					                    ($editor.data('textbox') ? $editor.textbox('textbox') : $editor).focus();
					                }
					                _this.lastEditingIndex = index;
								} else {
									_this.$table.datagrid('selectRow', _this.lastEditingIndex);
								}
							}
						}
					});
					_this.$btnConfirm.click(function() {
						if (_this.endEditing()) {
							row.value = _this.$table.datagrid('getRows');
							for (var i = 0; i < row.value.length; i ++) {
								if (/^\[[\w\W]*\]$/.test(row.value[i].options)) {
									row.value[i].options = $.decodeJson(row.value[i].options);
								}
							}
							Designer.PropBox.updateValue(index, row, true);
							_this.$window.window('close', true);
						}
					});
					_this.$btnCancel.click(function() {
						_this.$window.window('close', true);
					});
					_this._initEvent = true;
				}
			},
			setValue: function(value) {
				for (var i = 0; i < value.length; i ++) {
					if ($.isArray(value[i].options)) {
						value[i].options = $.encodeJson(value[i].options);
					}
				}
				editor.params.$table.datagrid('loadData', value);
			},
			show: function() {
				editor.params.$window.window('open', true);
			}
		}

		ctx = '${ctx}';
		Designer.init(
			'process-designer-tabs', 'process-designer-tabs-canvas', 'process-designer-tabs-content', 
			'process-designer-toolbox-save', 'precess-designer-toolbox-moveable', 'process-designer-toolbox-ele-delete',
			'process-designer-prop-form', 'process-designer-prop-box',
			'precess-designer-toolbox-citem',
			editor, ${process!"undefined"}, ${content!"false"}
		);
	});
</script>
</body>
</html>