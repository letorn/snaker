<table id="process-list-table" class="easyui-datagrid" data-options="rownumbers:true,toolbar:'#process-list-table-toolbar',fit:true">
	<thead>
		<tr>
			<th data-options="field:'id',width:60">流程编号</th>
			<th data-options="field:'name',width:150">流程名称</th>
			<th data-options="field:'content',width:680,formatter:$.encodeHtml">流程内容</th>
			<th data-options="field:'action',width:130,formatter:processListTableActionFormatter">操作</th>
		</tr>
	</thead>
</table>
<div id="process-list-table-toolbar" style="padding: 2px 5px;">
	<a id="process-list-table-init" class="easyui-linkbutton">初始化</a>
	<a id="process-list-table-designer" class="easyui-linkbutton">设计</a>
	<input id="process-list-table-search" class="easyui-searchbox" data-options="prompt:'流程显示名称'" style="width:200px"></input>
</div>
<script type="text/javascript">
	function processListTableActionFormatter(value, row) {
		return '<a class="process-list-table-start" data-process="' + row.id + '" data-text="' + row.name + '" style="cursor:pointer;color:blue">启动</a>&nbsp;&nbsp;' +
				'<a class="process-list-table-design" data-process="' + row.id + '" style="cursor:pointer;color:blue">设计</a>&nbsp;&nbsp;' + 
				'<a class="process-list-table-delete" data-process="' + row.id + '" style="cursor:pointer;color:blue">删除</a>';
	}

	$.render(function() {
		var $processListTable = $('#process-list-table');
		
		$('#process-list-table-init').click(function() {
			$.getJSON('process/init', function(data) {
				if (data.success) {
					$.messager.show({
						title: '提示',
						msg: '初始化完成！',
						timeout: 1000,
						showType: 'slide'
					});
					$processListTable.datagrid('reload');
				} else {
					$.messager.show({
						title: '提示',
						msg: '初始化失败！',
						timeout: 1000,
						showType: 'slide'
					});
				}
			});
		});
		
		$('#process-list-table-designer').click(function() {
			window.open ('process/designer')
		});
		
		$('#process-list-table-search').searchbox({
			searcher: function(value) {
				$processListTable.datagrid('load', {
					name: value
				});
			}
		});
		
		$processListTable.datagrid({
			url:'process/list',
			method:'get',
			onLoadSuccess: function() {
				$('.process-list-table-start').click(function() {
					$.getJSON('workflow/run/' + $(this).data('process'), function(data) {
						if (data.success) {
							$.messager.show({
								title: '提示',
								msg: '启动成功，请到待办任务就查看！',
								timeout: 1000,
								showType: 'slide'
							});
						} else {
							$.messager.show({
								title: '提示',
								msg: '启动失败！',
								timeout: 1000,
								showType: 'slide'
							});
						}
					});
				});
				
				$('.process-list-table-design').click(function() {
					window.open ('process/designer/' + $(this).data('process'));
				});
				
				$('.process-list-table-delete').click(function() {
					$.getJSON('process/delete/' + $(this).data('process'), function(data) {
						if (data.success) {
							$.messager.show({
								title: '提示',
								msg: '删除成功！',
								timeout: 1000,
								showType: 'slide'
							});
							$processListTable.datagrid('reload');
						} else {
							$.messager.show({
								title: '提示',
								msg: '删除失败！',
								timeout: 1000,
								showType: 'slide'
							});
						}
					});
				});
			}
		});
	});
</script>