<table id="process-list-table" class="easyui-datagrid" data-options="url:'process/list?state=1',method:'get',rownumbers:true,toolbar:'#process-list-table-toolbar'">
	<thead>
		<tr>
			<th data-options="field:'name',width:100">名称</th>
			<th data-options="field:'displayName',width:100">流程显示名称</th>
			<!-- <th data-options="field:'state',width:100,formatter:function(v){return v==1?'启用':'禁用'}">状态</th> -->
			<th data-options="field:'version',width:100">版本号</th>
			<th data-options="field:'id',width:150,formatter:processListTableActionFormatter">操作</th>
		</tr>
	</thead>
</table>
<div id="process-list-table-toolbar" style="padding: 2px 5px;">
	<a id="process-list-table-init" class="easyui-linkbutton">初始化</a>
	<a id="process-list-table-add" class="easyui-linkbutton">部署</a>
	<input id="process-list-table-search" class="easyui-searchbox" data-options="prompt:'流程显示名称'" style="width:200px"></input>
</div>
<form id="process-list-editwin" action="process/save" method="post" class="easyui-window" data-options="title:'编辑',modal:true,closed:true,iconCls:'icon-save'" style="width: 500px; height: 500px; padding: 10px;">
	<input type="hidden" name="process" />
	<input class="easyui-textbox" data-options="multiline:true" style="width:100%;height:400px" name="content">
	<a id="process-list-editwin-save" class="easyui-linkbutton" style="width:80px">保存</a>
	<a id="process-list-editwin-cancel" class="easyui-linkbutton" style="width:80px">取消</a>
</form>
<script type="text/javascript">
	function processListTableActionFormatter(value, row) {
		return '<a class="process-list-table-start" data-process="' + value + '" data-text="' + row.displayName + '" data-version="' + row.version + '" style="cursor:pointer;color:blue">启动</a>&nbsp;&nbsp;' +
				'<a class="process-list-table-edit" data-process="' + value + '" style="cursor:pointer;color:blue">编辑</a>&nbsp;&nbsp;' + 
				'<a class="process-list-table-delete" data-process="' + value + '" style="cursor:pointer;color:blue">删除</a>';
	}

	$.render(function() {
		var $processListTable = $('#process-list-table'), $processListEditWindow = $('#process-list-editwin');
		
		$('#process-list-table-init').click(function() {
			$.getJSON('process/init', function(data) {
				if (data.success) {
					$.messager.show({
						title: '提示',
						msg: '初始化完成！',
						timeout: 1000,
						showType: 'slide'
					});
					$processListTable.datagrid('reload');
				} else {
					$.messager.show({
						title: '提示',
						msg: '初始化失败！',
						timeout: 1000,
						showType: 'slide'
					});
				}
			});
		});
		
		$('#process-list-table-add').click(function() {
			$processListEditWindow.form('clear');
			$processListEditWindow.window('open');
		});
		
		$('#process-list-table-search').searchbox({
			searcher: function(value) {
				$processListTable.datagrid('load', {
					displayName: value,
					state: 1
				});
			}
		});
		
		$processListTable.datagrid({
			onLoadSuccess: function() {
				$('.process-list-table-start').click(function() {
					$this = $(this);
					window.addCenterTab($this.data('text') + 'v' + $this.data('version'), 'flow/all?process=' + $(this).data('process'));
				});
				
				$('.process-list-table-edit').click(function() {
					$processListEditWindow.form('load', 'process/edit/' + $(this).data('process'));
					$processListEditWindow.window('open');
				});
				
				$('.process-list-table-delete').click(function() {
					$.getJSON('process/delete/' + $(this).data('process'), function(data) {
						if (data.success) {
							$.messager.show({
								title: '提示',
								msg: '删除成功！',
								timeout: 1000,
								showType: 'slide'
							});
							$processListTable.datagrid('reload');
						} else {
							$.messager.show({
								title: '提示',
								msg: '删除失败！',
								timeout: 1000,
								showType: 'slide'
							});
						}
					});
				});
			}
		});
		
		$('#process-list-editwin-save').click(function() {
			$processListEditWindow.form('submit', {
			    success: function(data) {
			    	data = $.parseJSON(data);
			    	if (data.success) {
			    		$processListEditWindow.window('close');
			    		$processListTable.datagrid('reload');
			    	} else {
			    		$.messager.show({
							title: '提示',
							msg: '保存失败！',
							timeout: 1000,
							showType: 'slide'
						});
			    	}
			    }
			});
		});
		
		$('#process-list-editwin-cancel').click(function() {
			$processListEditWindow.window('close');
		});
	});
</script>