<table id="data-enterprise-table" class="easyui-datagrid" data-options="fit:true,rownumbers:true,singleSelect:true,pagination:true,pageSize:30,pageList:[30,60,90],toolbar:'#data-enterprise-table-toolbar'">
	<thead>
		<tr>
			<th data-options="field:'id'" style="width:60px">企业编号</th>
			<th data-options="field:'name'" style="width:240px">企业名称</th>
			<th data-options="field:'data_src'" style="width:80px">数据源</th>
			<th data-options="field:'data_key'" style="width:220px">唯一标识</th>
			<th data-options="field:'action',formatter:dataEnterpriseTableActionFormatter" style="width:180px">操作</th>
		</tr>
	</thead>
</table>
<div id="data-enterprise-table-toolbar" style="padding: 2px 5px;">
	数据源：<input id="data-enterprise-table-source" class="easyui-combobox" data-options="valueField:'value',textField:'text',url:'data/enterprise/sources'" style="width:120px" />
	<input id="data-enterprise-table-search" class="easyui-searchbox" data-options="prompt:'企业名称'" style="width:200px" />
	<a id="data-enterprise-table-upload" class="easyui-linkbutton">上传</a>
</div>
<div id="data-enterprise-upload-window" class="easyui-window" data-options="title:'上传',modal:true,closed:true,footer:'#data-enterprise-upload-footer'" style="width:600px;height:400px">
    <ul id="data-enterprise-upload-tree" class="easyui-tree" data-options="checkbox:true,url:'data/enterprise/categories'" style="width:100%;height:100%"></ul>
</div>
<div id="data-enterprise-upload-footer" style="padding:5px;">
	<a id="data-enterprise-upload-confirm" class="easyui-linkbutton" style="width:80px">确定</a>
	<a id="data-enterprise-upload-cancel" class="easyui-linkbutton" style="width:80px">取消</a>
</div>
<script type="text/javascript">
	function dataEnterpriseTableActionFormatter(value, row) {
		return '<a class="data-enterprise-table-look" data-enterprise="' + row.id + '" style="cursor:pointer;color:blue">查看</a>';
	}

	$.render(function() {
		var $dataEnterpriseTable = $('#data-enterprise-table'), $dataEnterpriseTableSource = $('#data-enterprise-table-source'), $dataEnterpriseTableSearch = $('#data-enterprise-table-search');
		var $dataEnterpriseUploadWindow = $('#data-enterprise-upload-window'), $dataEnterpriseUploadTree = $('#data-enterprise-upload-tree');

		$('#data-enterprise-table-upload').click(function() {
			$dataEnterpriseUploadWindow.window('open');
		});
		
		$dataEnterpriseTableSource.combobox({
			onSelect: function(record) {
				$dataEnterpriseTable.datagrid('load', {
					source: record.value,
					name: $dataEnterpriseTableSearch.val()
				});
			}
		});
		
		$dataEnterpriseTableSearch.searchbox({
			searcher: function(value) {
				$dataEnterpriseTable.datagrid('load', {
					source: $dataEnterpriseTableSource.combobox('getValue'),
					name: value
				});
			}
		});
		
		$dataEnterpriseTable.datagrid({
			url:'data/enterprise',
			method:'get',
			onLoadSuccess: function() {
				$('.data-enterprise-table-look').click(function() {
					console.log('look...');
				});
			}
		});
		
		$('#data-enterprise-upload-confirm').click(function() {
			var nodes = $dataEnterpriseUploadTree.tree('getChecked'), codes = [];
			for (var i = 0; i < nodes.length; i ++) {
				if (nodes[i].code)
					codes.push(nodes[i].code);
			}
			$.post('data/enterprise/upload', {
				ids: [1,2],
				codes: codes
			}, function(resp) {
				if (resp.success) {
					$.messager.show({
						title: '提示',
						msg: '上传成功！',
						timeout: 1000,
						showType: 'slide'
					});
				} else {
					$.messager.show({
						title: '提示',
						msg: '上传失败！',
						timeout: 1000,
						showType: 'slide'
					});
				}
			}, 'json')
		});
		$('#data-enterprise-upload-cancel').click(function() {
			$dataEnterpriseUploadWindow.window('close');
		});
	});
</script>