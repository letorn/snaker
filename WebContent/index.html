<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Snaker</title>
<script type="text/javascript" src="common/jquery.min.js"></script>
<script type="text/javascript" src="common/jquery.upload.js"></script>
<script type="text/javascript" src="common/jquery.custom.js"></script>
<link rel="stylesheet" type="text/css" href="common/easyui/themes/default/easyui.css">
<link rel="stylesheet" type="text/css" href="common/easyui/themes/icon.css">
<script type="text/javascript" src="common/easyui/jquery.easyui.min.js"></script>
<script type="text/javascript" src="common/easyui/locale/easyui-lang-zh_CN.js"></script>
<script type="text/javascript">
	$(function() {
		$.render = function(render) {
			$._render = render;
		}
		$.doRender = function(el, force) {
			var $el = $(el);
			if (!$el.rendered || force) {
				if (!$el.render && $._render) $el.render = $._render;
				if ($el.render) $el.render($el);
				$el.rendered = true;
			}
			delete $._render;
		}

		$.parser.auto = false;

		var $indexContent = $('#index-content'), $indexScripts = $('#index-scripts');
		
		window.Content = {
				$indexContent: $indexContent,
				addTab: function(text, location, scripts) {
					if ($indexContent.tabs('getTab', text)) {
						$indexContent.tabs('select', text)
					} else {
						if (scripts) {
							scripts = scripts.split(';')
							for (var i = 0; i < scripts.length; i++) {
								$indexScripts.append('<script type="text/javascript" src="' + scripts[i] + '"><\/script>');
							}
							$.parser.parse('index-scripts');
						}
						
						var tab = $indexContent.tabs('add', {
							closable: true,
							title: text,
							href: location,
							onLoad: function() {
								$.doRender(tab.tabs('getSelected'));
							}
						});
					}
				},
				getSelected: function() {
					var _this = window.Content;
					return _this.$indexContent.tabs('getSelected');
				}
		}
		
		$('#index-accordion p').click(function() {
			var $p = $(this), text = $p.text(), location = $p.data('location'), scripts = $p.data('scripts');
			if ($indexContent.tabs('getTab', text)) {
				$indexContent.tabs('select', text)
			} else {
				if (scripts) {
					scripts = scripts.split(';')
					for (var i = 0; i < scripts.length; i++) {
						$indexScripts.append('<script type="text/javascript" src="' + scripts[i] + '"><\/script>');
					}
					$.parser.parse('index-scripts');
				}
				
				var tab = $indexContent.tabs('add', {
					closable: true,
					title: text,
					href: location,
					onLoad: function() {
						$.parser.parse(tab);
						$.doRender(tab);
					}
				});
			}
		});
		
		$('#index-content-enterprise-table').datagrid({
			url: 'data/enterprise/sum',
			onBeforeLoad: function(param) {
				var date = $('#index-content-enterprise-date').val();
				param.beginTime = date + ' 00:00:00';
				param.endTime = date + ' 23:59:59';
			},
			onLoadSuccess: function(data) {
				var row = {name: '全部', total: 0, day_new: 0, syn: 0, day_syn: 0};
				for (var i = 0; i < data.rows.length; i ++) {
					row.total = row.total + data.rows[i].total;
					row.day_new = row.day_new + data.rows[i].day_new;
					row.syn = row.syn + data.rows[i].syn;
					row.day_syn = row.day_syn + data.rows[i].day_syn;
				}
				$(this).datagrid('insertRow', {index: 0, row: row});
				$(this).datagrid('freezeRow', 0);
			}
		});
		
		$('#index-content-jobhunter-table').datagrid({
			url: 'data/jobhunter/sum',
			onBeforeLoad: function(param) {
				var date = $('#index-content-jobhunter-date').val();
				param.beginTime = date + ' 00:00:00';
				param.endTime = date + ' 23:59:59';
			},
			onLoadSuccess: function(data) {
				var row = {name: '全部', total: 0, day_new: 0, syn: 0, day_syn: 0};
				for (var i = 0; i < data.rows.length; i ++) {
					row.total = row.total + data.rows[i].total;
					row.day_new = row.day_new + data.rows[i].day_new;
					row.syn = row.syn + data.rows[i].syn;
					row.day_syn = row.day_syn + data.rows[i].day_syn;
				}
				$(this).datagrid('insertRow', {index: 0, row: row});
				$(this).datagrid('freezeRow', 0);
			}
		});
		
		$('#index-content-talk-table').datagrid({
			url: 'data/talk/sum',
			onBeforeLoad: function(param) {
				var date = $('#index-content-talk-date').val();
				param.beginTime = date + ' 00:00:00';
				param.endTime = date + ' 23:59:59';
			},
			onLoadSuccess: function(data) {
				var row = {name: '全部', total: 0, day_new: 0, syn: 0, day_syn: 0};
				for (var i = 0; i < data.rows.length; i ++) {
					row.total = row.total + data.rows[i].total;
					row.day_new = row.day_new + data.rows[i].day_new;
					row.syn = row.syn + data.rows[i].syn;
					row.day_syn = row.day_syn + data.rows[i].day_syn;
				}
				$(this).datagrid('insertRow', {index: 0, row: row});
				$(this).datagrid('freezeRow', 0);
			}
		});
	});
	function onIndexContentEnterpriseTableRefresh() {
		$('#index-content-enterprise-table').datagrid('reload')
	}
	function onIndexContentJobhunterTableRefresh() {
		$('#index-content-jobhunter-table').datagrid('reload')
	}
	function onIndexContentTalkTableRefresh() {
		$('#index-content-talk-table').datagrid('reload')
	}
</script>
</head>
<body class="easyui-layout">
	<div id="index-scripts" style="display:none"></div>
	<div id="index-accordion" class="easyui-accordion" data-options="region:'west',title:'菜单',split:true" style="width:100px">
		<div data-options="title:'任务管理'" style="text-align:center">
			<p data-location="process/index.html" style="cursor:pointer;color:blue">工作流程</p>
			<p data-location="instance/index.html" style="cursor:pointer;color:blue">流程实例</p>
			<p data-location="data/file.html" style="cursor:pointer;color:blue">文件管理</p>
			<p data-location="data/enterprise.html" style="cursor:pointer;color:blue">所有企业</p>
			<p data-location="data/jobhunter.html" style="cursor:pointer;color:blue">所有求职者</p>
			<p data-location="data/talk.html" style="cursor:pointer;color:blue">所有宣讲会</p>
		</div>
	</div>
	<div id="index-content" class="easyui-tabs" data-options="region:'center'">
		<div data-options="title:'企业汇总'">
			<table id="index-content-enterprise-table" class="easyui-datagrid" data-options="fit:true,rownumbers:true,singleSelect:true,toolbar:'#index-content-enterprise-toolbar'">
				<thead>
					<tr>
						<th data-options="field:'name'" style="width:260px">行业</th>
						<th data-options="field:'total'" style="width:60px">所有</th>
						<th data-options="field:'day_new'" style="width:60px">当日新增</th>
						<th data-options="field:'syn'" style="width:60px">已上传</th>
						<th data-options="field:'day_syn'" style="width:60px">当日上传</th>
					</tr>
				</thead>
			</table>
			<div id="index-content-enterprise-toolbar" style="padding: 2px 5px;">
				当日：<input id="index-content-enterprise-date" class="easyui-datebox" data-options="value:Date(),formatter:function(v){return v.getFullYear()+'-'+(v.getMonth()+1)+'-'+v.getDate()},onSelect:onIndexContentEnterpriseTableRefresh" style="width:100px" />
				<a id="index-content-enterprise-refresh" class="easyui-linkbutton" data-options="onClick:onIndexContentEnterpriseTableRefresh" style="width:80px">刷新</a>
			</div>
		</div>
		<div data-options="title:'求职者汇总'">
			<table id="index-content-jobhunter-table" class="easyui-datagrid" data-options="fit:true,rownumbers:true,singleSelect:true,toolbar:'#index-content-jobhunter-toolbar'">
				<thead>
					<tr>
						<th data-options="field:'name'" style="width:260px">岗位</th>
						<th data-options="field:'total'" style="width:60px">所有</th>
						<th data-options="field:'day_new'" style="width:60px">当日新增</th>
						<th data-options="field:'syn'" style="width:60px">已上传</th>
						<th data-options="field:'day_syn'" style="width:60px">当日上传</th>
					</tr>
				</thead>
			</table>
			<div id="index-content-jobhunter-toolbar" style="padding: 2px 5px;">
				当日：<input id="index-content-jobhunter-date" class="easyui-datebox" data-options="value:Date(),formatter:function(v){return v.getFullYear()+'-'+(v.getMonth()+1)+'-'+v.getDate()},onSelect:onIndexContentJobhunterTableRefresh" style="width:100px" />
				<a id="index-content-jobhunter-refresh" class="easyui-linkbutton" data-options="onClick:onIndexContentJobhunterTableRefresh" style="width:80px">刷新</a>
			</div>
		</div>
		<div data-options="title:'宣讲会汇总'">
			<table id="index-content-talk-table" class="easyui-datagrid" data-options="fit:true,rownumbers:true,singleSelect:true,toolbar:'#index-content-talk-toolbar'">
				<thead>
					<tr>
						<th data-options="field:'name'" style="width:260px">来源</th>
						<th data-options="field:'total'" style="width:60px">所有</th>
						<th data-options="field:'day_new'" style="width:60px">当日新增</th>
						<th data-options="field:'syn'" style="width:60px">已上传</th>
						<th data-options="field:'day_syn'" style="width:60px">当日上传</th>
					</tr>
				</thead>
			</table>
			<div id="index-content-talk-toolbar" style="padding: 2px 5px;">
				当日：<input id="index-content-talk-date" class="easyui-datebox" data-options="value:Date(),formatter:function(v){return v.getFullYear()+'-'+(v.getMonth()+1)+'-'+v.getDate()},onSelect:onIndexContentTalkTableRefresh" style="width:100px" />
				<a id="index-content-talk-refresh" class="easyui-linkbutton" data-options="onClick:onIndexContentTalkTableRefresh" style="width:80px">刷新</a>
			</div>
		</div>
	</div>
</body>
</html>